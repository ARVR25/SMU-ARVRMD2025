<!doctype html><html><head><meta charset="utf-8"/><title>SMU-ARVRMD2025/방명록</title><meta name="viewport" content="width=device-width,initial-scale=1"/><link rel="stylesheet" href="../styles/style.css"/><link rel="icon" type="image/x-icon" href="../images/PageIcon.ico"></head><body class="invite"><nav class="top-nav"><a class="title" href="../index.html">MOMENTUM</a><div id="nav-link"><div class="dropdown"><a class="nav-link2">ABOUT</a><div class="dropdown-content"><a href="./about.html">Introduction</a> <a href="./about_poster.html">Visual Identity</a></div></div><a href="./project.html" class="nav-link">PROJECT</a> <a href="./designers.html" class="nav-link">DESIGNERS</a> <a href="./invite.html" class="nav-link">방명록</a></div></nav><div class="guestbook-display" id="guestbook-container"></div><div class="input-form-container"><div class="input-header-inner"><h4 style="color: white;">MOMENTUM 방명록</h4><button type="button" id="guest-submit">보내기</button></div><div class="input-group"><input id="guest-name" placeholder="이름을 남겨주세요..."/></div><div class="input-group"><textarea id="guest-content" placeholder="메시지를 남겨주세요..."></textarea></div></div><div id="alert-modal"></div><script type="module">import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
            import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";
            import {
                getFirestore,
                collection,
                getDocs,
                addDoc,
            } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

            // Firebase 설정 (원본 코드 유지)
            const firebaseConfig = {
                apiKey: "AIzaSyAQXfk5GDFCa0PdarLHDYll0rrEB5f1ZF8",
                authDomain: "smu-arvrmd2025.firebaseapp.com",
                projectId: "smu-arvrmd2025",
                storageBucket: "smu-arvrmd2025.firebasestorage.app",
                messagingSenderId: "591519928169",
                appId: "1:591519928169:web:5df88ed958531098b9b7f8",
                measurementId: "G-E83GY0L0WQ"
            };

            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
            const db = getFirestore(app);
            const guestRef = collection(db, "guests");
            const container = document.querySelector("#guestbook-container");

            // 경고 메시지 표시 함수 (alert 대체)
            function showAlert(message) {
                const modal = document.getElementById("alert-modal");
                modal.textContent = message;
                modal.style.display = 'block';
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 2500); // 2.5초 후 자동으로 사라짐
            }

            // 방명록 작성 함수
            async function sendGuest() {
                const nameInput = document.querySelector("#guest-name");
                const contentInput = document.querySelector("#guest-content");
                const name = nameInput.value.trim();
                const content = contentInput.value.trim();

                if (!name || !content) {
                    showAlert("이름과 내용을 모두 입력해주세요.");
                    return;
                }

                try {
                    await addDoc(guestRef, {
                        name: name,
                        content: content,
                        created_at: new Date(),
                    });
                    
                    nameInput.value = "";
                    contentInput.value = "";
                } catch (error) {
                    console.error("방명록 작성 중 오류 발생: ", error);
                    showAlert("작성 중 오류가 발생했습니다. 다시 시도해주세요.");
                }
            }

            // 두 아이템이 겹치는지 확인하는 함수
            function checkOverlap(rect1, rect2) {
                return rect1.left < rect2.left + rect2.width &&
                    rect1.left + rect1.width > rect2.left &&
                    rect1.top < rect2.top + rect2.height &&
                    rect1.top + rect1.height > rect2.top;
            }

            // 무작위 위치에 방명록 표시 (겹치지 않게)
            async function showRandomGuests() {
                // 기존 팝업을 먼저 제거하기 전에 사라지는 효과를 적용
                const oldGuests = document.querySelectorAll(".guestbook-item");
                if (oldGuests.length > 0) {
                    oldGuests.forEach(item => item.classList.add('fade-out'));
                    
                    // 애니메이션이 끝날 때까지 기다린 후 컨테이너를 비움
                    await new Promise(resolve => setTimeout(resolve, 2000)); 
                }
                container.innerHTML = ''; 
                
                try {
                    const allGuests = await getDocs(guestRef);
                    const guestList = allGuests.docs;
                    
                    if (guestList.length === 0) {
                        console.log("방명록 내용이 없습니다.");
                        return;
                    }

                    const shuffledGuests = guestList.sort(() => 0.5 - Math.random());
                    const limitedGuests = shuffledGuests.slice(0, 8); 

                    const placedItems = []; 
                    let time = 0;
                    const itemSize = 250; 

                    limitedGuests.forEach((doc) => {
                        const data = doc.data();
                        const date = new Date(data.created_at.toDate());
                        const myDate = `${date.getFullYear()}년 ${date.getMonth() + 1}월 ${date.getDate()}일 ${date.getHours()}:${date.getMinutes()}`;
                        
                        const guestItem = document.createElement("div");
                        guestItem.classList.add("guestbook-item");
                        
                        let newX, newY, isOverlapping;
                        let attempts = 0;
                        const maxAttempts = 50; 

                        do {
                            isOverlapping = false;
                            newX = Math.random() * (container.clientWidth - itemSize);
                            newY = Math.random() * (container.clientHeight - itemSize);

                            const newRect = {
                                left: newX,
                                top: newY,
                                width: itemSize,
                                height: guestItem.offsetHeight || 150 
                            };

                            for (const placedRect of placedItems) {
                                if (checkOverlap(newRect, placedRect)) {
                                    isOverlapping = true;
                                    break;
                                }
                            }
                            attempts++;
                        } while (isOverlapping && attempts < maxAttempts);

                        if (!isOverlapping) {
                            guestItem.style.left = `${newX}px`;
                            guestItem.style.top = `${newY}px`;
                            
                            guestItem.innerHTML = `
                                <a class="bodytext-xs" style="font-weight: bold;">${data.name}</a>
                                <p class="bodytext-xs" style="font-weight: bold;">${data.content}</p>
                                <div class="bodytext-xs2" style="font-weight: bold;">작성일: ${myDate}</div>
                            `;
                            
                            container.appendChild(guestItem);

                            const finalRect = {
                                left: newX,
                                top: newY,
                                width: guestItem.offsetWidth,
                                height: guestItem.offsetHeight
                            };
                            placedItems.push(finalRect);

                            guestItem.style.animationDelay = `${time}s`;
                            time += 0.1;
                        }
                    });
                } catch (error) {
                    console.error("방명록 불러오기 중 오류 발생: ", error);
                }
            }

            // 이벤트 리스너
            document.querySelector("#guest-submit").addEventListener("click", async () => {
                await sendGuest();
                showRandomGuests();
            });
            
            // 페이지 로드 시 방명록 표시
            document.addEventListener("DOMContentLoaded", () => {
                showRandomGuests();
                // 10초마다 방명록 갱신
                setInterval(showRandomGuests, 12000);
            });
            
        document.addEventListener('DOMContentLoaded', () => {
            const aboutLink = document.querySelector('.dropdown .nav-link2');
            const dropdownContent = document.querySelector('.dropdown-content');

            if (aboutLink && dropdownContent) {
                aboutLink.addEventListener('click', (event) => {
                    event.preventDefault(); 
                    if (dropdownContent.style.display === 'block') {
                        dropdownContent.style.display = 'none';
                    } else {
                        dropdownContent.style.display = 'block';
                    }
                });

                document.addEventListener('click', (event) => {
                    if (!aboutLink.contains(event.target) && !dropdownContent.contains(event.target)) {
                        dropdownContent.style.display = 'none';
                    }
                });
            }
        });</script></body></html>